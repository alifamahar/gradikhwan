<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ikhwan's Graduation Day!</title>
  <link rel="icon" type="image/x-icon" href="pala.png">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Bellefair&family=Great+Vibes&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Jersey+20&family=Monsieur+La+Doulaise&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap"
    rel="stylesheet" />

  <style>
    /* =========================
       RESET + GLOBAL
    ========================= */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --pad: clamp(16px, 4vw, 64px);
      --radius: 12px;
      --shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
      --glass: rgba(39, 69, 97, 0.72);
    }

    html,
    body {
      width: 100%;
      min-height: 100%;
      scroll-behavior: smooth;
      overflow-x: hidden;
    }

    body {
      background: linear-gradient(#27456179, #0000004e),
        url("bgg.jpg") no-repeat center / cover;
      background-attachment: fixed;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }

    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
      }
    }

    .hidden {
      display: none !important;
    }

    .container {
      width: min(900px, 94vw);
      margin-inline: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    /* =========================
       HERO
    ========================= */
    .hero-section {
      min-height: 100svh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--pad) 0;
    }

    /* INTRO reveal */
    .initial-blur {
      filter: blur(18px);
      opacity: 0;
      transform: translateY(34px);
      animation: introReveal 1.1s cubic-bezier(.25, .9, .2, 1) forwards;
    }

    /* khusus photos: blur lebih lama */
    .initial-blur-photos {
      filter: blur(18px);
      opacity: 0;
      transform: translateY(34px);
      animation: introReveal 2.6s cubic-bezier(.25, .9, .2, 1) forwards;
      /* atur durasi */
    }


    @keyframes introReveal {
      to {
        filter: blur(0);
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* fade out for hero when switching "page" */
    .fade-away {
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity .55s ease, transform .55s ease;
      pointer-events: none;
    }

    /* STEP 1: sealed */
    .sealed-img {
      width: min(820px, 40vw);
      height: auto;
      cursor: pointer;
      transition: transform 0.3s ease;
      border-radius: 10px;
      box-shadow: var(--shadow);
      user-select: none;
      -webkit-user-drag: none;
    }

    .sealed-img:hover {
      transform: scale(1.03);
    }

    /* =========================
       STEP 2: opened envelope assembly
    ========================= */
    .envelope-assembly {
      position: relative;
      width: 50%;
      height: min(640px, 78vh);
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    .env-layer {
      position: absolute;
      width: 100%;
      bottom: 0;
      user-select: none;
      -webkit-user-drag: none;
    }

    .env-back {
      z-index: 1;
    }

    .env-front {
      z-index: 3;
      pointer-events: none;
    }

    .env-drop .env-layer {
      transform: translateY(60px);
      transition: transform 0.65s cubic-bezier(0.25, 0.1, 0.25, 1);
    }

    /* Letter container */
    .letter-container {
      position: absolute;
      width: min(300px, 40vw);
      bottom: 40px;
      z-index: 2;
      cursor: pointer;
      overflow: hidden;
      height: min(380px, 50vh);
      border-radius: 8px;
      background: white;
      box-shadow: var(--shadow);

      /* smoothness */
      transition:
        bottom 1.1s cubic-bezier(0.22, 1, 0.36, 1),
        height 1.1s cubic-bezier(0.22, 1, 0.36, 1),
        transform .28s ease;
    }

    /* Surat: fade-in saat amplop dibuka */
    .letter-fade-in {
      opacity: 0;
      transform: translateY(14px) scale(.985);
      animation: letterFadeIn .75s ease forwards;
    }

    @keyframes letterFadeIn {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* hover surat jadi 1.2x */
    .letter-container:hover {
      transform: scale(1.2);
    }

    /* ketika lagi animasi "kebuka", hover jangan ganggu */
    .letter-container.is-opening:hover {
      transform: none;
    }

    .letter-content {
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      user-select: none;
      -webkit-user-drag: none;
    }

    /* letter slide up */
    .letter-slide-up {
      bottom: 90px;
      height: min(380px, 78vh);
      z-index: 5;
      overflow: visible;
      transform: scale(1.06);
    }

    /* =========================
       PHOTOS SECTION
    ========================= */
    .photos-section {
      min-height: 100svh;
      padding: clamp(28px, 5vw, 72px) var(--pad);
      background: linear-gradient(#0000004e, #27456199), url("bg2.jpg") no-repeat center / cover;
    }

    .section-title {
      text-align: center;
      font-family: "Great Vibes", cursive;
      font-size: clamp(2rem, 3vw, 3rem);
      margin: clamp(10px, 3vw, 30px) 0 clamp(10px, 3vw, 30px);
      transition: opacity .35s ease, transform .35s ease, filter .35s ease;
      will-change: opacity, transform, filter;
    }

    /* anim halus pas title ganti */
    .title-swap-out {
      opacity: 0;
      transform: translateY(-8px);
      filter: blur(6px);
    }

    .title-swap-in {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }

    .photos-wrapper {
      width: min(980px, 100%);
      margin: 0 auto;
      position: relative;
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100px, 50%), 1fr));
      gap: clamp(10px, 3vw, 40px);
      width: 80%;
      margin: 0 auto;
    }

    /* --- TAMBAHAN BARU UNTUK HP --- */
    @media (max-width: 768px) {
      .photo-grid {
        /* Memaksa 1 kolom penuh */
        grid-template-columns: 1fr;
        /* Membatasi lebar agar tidak terlalu raksasa di HP */
        max-width: 320px;
        margin-inline: auto;
        /* Menambah jarak vertikal */
        gap: 50px;
      }
    }

    /* NEXT button */
    .next-btn {
      position: absolute;
      right: -12px;
      top: 50%;
      transform: translate(100%, -50%);
      border: 0;
      background: rgba(255, 255, 255, 0.92);
      color: #274561;
      font-family: "DM Sans", sans-serif;
      font-weight: 800;
      letter-spacing: .3px;
      padding: 10px 16px;
      border-radius: 999px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, .35);
      cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;
      user-select: none;
      z-index: 30;
      font-size: 20px;
      line-height: 1;
    }

    .next-btn:hover {
      transform: translate(100%, -50%) scale(1.06);
      box-shadow: 0 18px 36px rgba(0, 0, 0, .45);
    }

    .next-btn:active {
      transform: translate(100%, -50%) scale(0.98);
    }

    .next-btn[disabled] {
      opacity: .55;
      cursor: not-allowed;
    }

    @media (max-width: 900px) {
      .next-btn {
        position: static;
        transform: none;
        display: block;
        margin: 22px auto 0;
      }
    }

    /* Polaroid wrapper (rotation stays here) */
    .polaroid-wrap {
      transition: transform 0.35s ease;
      position: relative;
      z-index: 1;
    }

    .polaroid-wrap:hover {
      transform: scale(1.05) rotate(0deg) !important;
      z-index: 20;
    }

    /* Card flips */
    .polaroid-card {
      background: white;
      padding: 15px 15px 20px 15px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      position: relative;
      border-radius: 10px;
      overflow: hidden;

      transform-style: preserve-3d;
      transition: transform 0.75s cubic-bezier(.2, .9, .2, 1);
      will-change: transform;
    }

    .polaroid-card.flipping {
      transform: rotateY(90deg);
    }

    .img-container {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 5;
      overflow: hidden;
      background: #eee;
      border-radius: 8px;
      backface-visibility: hidden;
    }

    .img-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      inset: 0;

      /* hover swap tetap halus */
      transition: opacity 0.55s ease-in-out, transform 0.55s ease-in-out, filter 0.55s ease-in-out;
      user-select: none;
      -webkit-user-drag: none;
      will-change: opacity, transform, filter;
    }

    .img-hover {
      opacity: 0;
    }

    /* KEEP hover photo swap */
    .polaroid-wrap:hover .img-default {
      opacity: 0;
    }

    .polaroid-wrap:hover .img-hover {
      opacity: 1;
    }

    /* ekstra: pas flip, gambar juga dikasih blur dikit biar transisi nggak "kasar" */
    .polaroid-card.is-swapping .img-container img {
      filter: blur(6px);
      transform: scale(1.02);
    }

    .caption {
      text-align: center;
      margin-top: 14px;
      font-family: "Bellefair", serif;
      font-size: clamp(1rem, 3vw, 1rem);
      font-weight: bold;
      color: #274561;
      backface-visibility: hidden;
      transition: opacity .35s ease, transform .35s ease, filter .35s ease;
      will-change: opacity, transform, filter;
    }

    .cap-swap-out {
      opacity: 0;
      transform: translateY(6px);
      filter: blur(6px);
    }

    .cap-swap-in {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }

    /* =========================
       VIDEO SECTION
    ========================= */
    .video-wrap {
      width: min(700px, 80vw);
      aspect-ratio: 16 / 9;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0, 0, 0, .5);
      position: relative;
    }

    /* preview layer */
    .yt-preview {
      width: 100%;
      height: 100%;
      position: relative;
      cursor: pointer;
      user-select: none;
      outline: none;
    }

    .yt-thumb {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: scale(1.02);
      transition: transform .35s ease, filter .35s ease;
      filter: saturate(1.05) contrast(1.05);
    }

    /* subtle overlay biar teks & tombol pop */
    .yt-shade {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0, 0, 0, .15), rgba(0, 0, 0, .55));
      opacity: .65;
      transition: opacity .35s ease;
    }

    /* play button */
    .yt-play {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      transform: translateY(0);
      transition: transform .35s ease;
    }

    .yt-play-svg {
      width: clamp(68px, 10vw, 96px);
      height: auto;
      filter: drop-shadow(0 14px 28px rgba(0, 0, 0, .45));
      transform: scale(1);
      transition: transform .25s ease, filter .25s ease;
    }

    .yt-play-bg {
      fill: rgba(30, 30, 30, .78);
      transition: fill .25s ease;
    }

    .yt-play-tri {
      fill: #fff;
    }

    /* small hint text */
    .yt-hint {
      position: absolute;
      left: 16px;
      bottom: 14px;
      padding: 8px 12px;
      border-radius: 999px;
      font-family: "DM Sans", sans-serif;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: .2px;
      background: rgba(0, 0, 0, .45);
      color: rgba(255, 255, 255, .92);
      backdrop-filter: blur(6px);
      opacity: .85;
      transition: opacity .25s ease, transform .25s ease;
    }

    /* hover effects */
    .yt-preview:hover .yt-thumb {
      transform: scale(1.06);
      filter: saturate(1.15) contrast(1.1);
    }

    .yt-preview:hover .yt-shade {
      opacity: .5;
    }

    .yt-preview:hover .yt-play {
      transform: translateY(-2px);
    }

    .yt-preview:hover .yt-play-svg {
      transform: scale(1.08);
      filter: drop-shadow(0 18px 34px rgba(0, 0, 0, .55));
    }

    .yt-preview:hover .yt-play-bg {
      fill: rgba(220, 38, 38, .92);
      /* merah ala YouTube */
    }

    .yt-preview:hover .yt-hint {
      opacity: 1;
      transform: translateY(-2px);
    }

    /* iframe inside slot */
    #ytSlot iframe {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* =========================
       ENDED MODE: matiin hover swap + ganti overlay putih
    ========================= */
    .tap-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(255, 255, 255, .5);
      color: #274561;
      font-family: "Bellefair";
      font-weight: 800;
      letter-spacing: .2px;
      opacity: 0;
      transition: opacity .25s ease;
      border-radius: 8px;
      text-align: center;
      padding: 12px;
    }

    .photos-section.ended-mode .img-hover {
      opacity: 0 !important;
    }

    .photos-section.ended-mode .polaroid-wrap:hover .img-default {
      opacity: 1 !important;
    }

    .photos-section.ended-mode .polaroid-wrap:hover .tap-overlay {
      opacity: 1;
    }

    /* =========================
       CHOOSE SECTION (3 sealed)
    ========================= */
    .choose-grid {
      display: flex;
      gap: clamp(14px, 3vw, 28px);
      justify-content: flex-end;
      align-items: center;
      width: min(900px, 94vw);
      margin-left: auto;
    }

    @media (max-width: 768px) {
      .choose-grid {
        justify-content: center;
        flex-wrap: wrap;
      }
    }

    .choose-sealed {
      border: 0;
      background: transparent;
      padding: 14px;
      border-radius: 16px;
      cursor: pointer;
      transition: transform .25s ease, box-shadow .25s ease, background .25s ease;
    }

    .choose-sealed img {
      width: min(220px, 28vw);
      height: auto;
      display: block;
      border-radius: 10px;
      box-shadow: var(--shadow);
      user-select: none;
      -webkit-user-drag: none;
    }

    .choose-sealed:hover {
      background: url("bg2.png") no-repeat center / cover;
      box-shadow: 0 18px 36px rgba(0, 0, 0, .45);
      transform: translateY(-2px) scale(1.03);
    }

    /* =========================
       SCROLL ANIMATION (Reveal)
       - reveal-up: pakai translateY
       - reveal-fade: hanya opacity/filter (AMAN untuk elemen yang punya transform rotate)
    ========================= */
    .reveal-up {
      opacity: 0;
      transform: translateY(28px);
      transition: opacity 0.9s ease, transform 0.9s ease;
      transition-delay: var(--d, 0s);
    }

    .reveal-up.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    .reveal-fade {
      opacity: 0;
      filter: blur(10px);
      transition: opacity 0.9s ease, filter 0.9s ease;
      transition-delay: var(--d, 0s);
    }

    .reveal-fade.is-visible {
      opacity: 1;
      filter: blur(0);
    }

    .next-chapter-link {
      display: block;
      margin: 26px auto 0;
      padding: 12px 18px;
      border-radius: 999px;
      text-align: center;
      font-family: "Bellefair";
      font-weight: 800;
      letter-spacing: .2px;
      color: rgba(255, 255, 255, .95);
      text-decoration: none;
      transition: transform .2s ease, background .2s ease, box-shadow .2s ease, opacity .2s ease;
    }

    .next-chapter-link:hover {
      transform: scale(1.05);
      color: bisque;
    }

    /* A11y: hormati reduce motion */
    @media (prefers-reduced-motion: reduce) {

      .reveal-up,
      .reveal-fade,
      .sealed-img,
      .polaroid-wrap,
      .polaroid-card,
      .next-btn,
      .initial-blur,
      .letter-container,
      .img-container img,
      .section-title,
      .caption,
      .tap-overlay,
      .choose-sealed {
        transition: none !important;
        animation: none !important;
      }

      .reveal-up,
      .reveal-fade {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
      }



    }
  </style>
</head>

<body>
  <audio src="Prologue (2).mp3" id="bg-audio" preload="auto" loop></audio>

  <!-- HERO -->
  <section class="hero-section" id="hero">
    <div class="container">

      <div id="step-sealed">
        <img src="sealed.png" class="sealed-img" alt="Amplop Tertutup" />
      </div>

      <div id="step-opened" class="envelope-assembly hidden">
        <img src="envelope-back.png" class="env-layer env-back" alt="Amplop Belakang" />

        <div id="letter-container" class="letter-container letter-fade-in" aria-label="Klik surat">
          <img src="letter.png" class="letter-content" alt="Isi Surat" />
        </div>

        <img src="envelope-front.png" class="env-layer env-front" alt="Amplop Depan" />
      </div>

    </div>
  </section>

  <!-- PHOTOS -->
  <section class="photos-section hidden" id="photos">
    <h2 class="section-title reveal-up title-swap-in" id="photos-title" style="--d:.05s">How It Started</h2>

    <div class="photos-wrapper">
      <div class="photo-grid">
        <!-- Card 1 -->
        <div class="reveal-fade" style="--d:.10s">
          <div class="polaroid-wrap" style="transform: rotate(-3deg);">
            <div class="polaroid-card" data-card="0">
              <div class="img-container">
                <img src="1.jpg" alt="Foto Default" class="img-default">
                <img src="5.png" alt="Foto Hover" class="img-hover">
                <div class="tap-overlay">Tap to continue!</div>
              </div>
              <div class="caption cap-swap-in">You</div>
            </div>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="reveal-fade" style="--d:.18s">
          <div class="polaroid-wrap" style="transform: rotate(2deg);">
            <div class="polaroid-card" data-card="1">
              <div class="img-container">
                <img src="2.jpeg" alt="Foto Default" class="img-default">
                <img src="ikhwan2.png" alt="Foto Hover" class="img-hover">
                <div class="tap-overlay">Tap to continue!</div>
              </div>
              <div class="caption cap-swap-in">did</div>
            </div>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="reveal-fade" style="--d:.26s">
          <div class="polaroid-wrap" style="transform: rotate(-1deg);">
            <div class="polaroid-card" data-card="2">
              <div class="img-container">
                <img src="3.jpeg" alt="Foto Default" class="img-default">
                <img src="5.png" alt="Foto Hover" class="img-hover">
                <div class="tap-overlay">Tap to continue!</div>
              </div>
              <div class="caption cap-swap-in">great!â‹†Ë™âŸ¡</div>
            </div>
          </div>
        </div>
      </div>

      <button class="next-btn" id="next-btn" type="button" aria-label="Next">ðŸŽ“</button>
    </div>
  </section>

  <!-- VIDEO -->
  <section class="photos-section hidden" id="video-section"
    style="background: linear-gradient(#27456179, #0000004e), url('bgg.jpg') no-repeat center / cover; background-attachment: fixed; padding-top: 15px !important">
    <h2 class="section-title reveal-up">Look at how gorgeous you are with that fits!</h2>

    <div class="container" style="display:flex; flex-direction:column; gap:20px; align-items:center;">
      <div class="video-wrap">
        <!-- PREVIEW -->
        <div class="yt-preview" id="ytPreview" role="button" tabindex="0" aria-label="Lanjut">
          <img src="thumb.jpg.png" alt="Preview video" class="yt-thumb">
          <div class="yt-shade"></div>

          <div class="yt-play" aria-hidden="true">
            <svg viewBox="0 0 68 48" class="yt-play-svg">
              <path class="yt-play-bg"
                d="M66.52 7.74a8 8 0 0 0-5.64-5.66C55.9 0.67 34 0.67 34 0.67s-21.9 0-26.88 1.41A8 8 0 0 0 1.48 7.74 83.8 83.8 0 0 0 0 24a83.8 83.8 0 0 0 1.48 16.26 8 8 0 0 0 5.64 5.66C12.1 47.33 34 47.33 34 47.33s21.9 0 26.88-1.41a8 8 0 0 0 5.64-5.66A83.8 83.8 0 0 0 68 24a83.8 83.8 0 0 0-1.48-16.26z" />
              <path class="yt-play-tri" d="M45 24 27 14v20z" />
            </svg>
          </div>

          <div class="yt-hint">Ikhwan's Graduation Day</div>
        </div>

        <!-- SLOT IFRAME (nggak dipakai lagi, tapi aman kalau mau dipakai) -->
        <div id="ytSlot" class="hidden"></div>
      </div>

    </div>
  </section>

  <!-- CHOOSE (3 SEALED) -->
  <section class="photos-section hidden" id="choose-section"
    style="background: linear-gradient(#0000004e, #27456199), url('bg2.png') no-repeat center / cover;">
    <h2 class="section-title reveal-up">Here's some small gifts for you!</h2>

    <div class="container" style="padding: 30px 0;">
      <div class="choose-grid">
        <button class="choose-sealed" data-go="hadiah1.html" aria-label="Buka page 1">
          <img src="sealed.png" alt="Sealed 1">
        </button>

        <button class="choose-sealed" data-go="hadiah2.html" aria-label="Buka page 2">
          <img src="sealed.png" alt="Sealed 2">
        </button>

        <button class="choose-sealed" data-go="hadiah3.html" aria-label="Buka page 3">
          <img src="sealed.png" alt="Sealed 3">
        </button>
      </div>
    </div>
    <a class="next-chapter-link" href="next-chapter.html">
      Have you opened all the gifts? Letâ€™s go to the next chapter!
    </a>
  </section>
  

  <script>
    // =========================
    // VIDEO (OPEN YT IN NEW TAB)
    // =========================
    const VIDEO_ID = "gTM8tlva-T4";
    const START_TIME = 10893;

    document.addEventListener("DOMContentLoaded", () => {
      const hero = document.getElementById("hero");
      const sealed = document.getElementById("step-sealed");
      const opened = document.getElementById("step-opened");
      const letter = document.getElementById("letter-container");

      const photos = document.getElementById("photos");
      const photosTitle = document.getElementById("photos-title");
      const videoSection = document.getElementById("video-section");
      const chooseSection = document.getElementById("choose-section");

      const lagu = document.getElementById("bg-audio");
      const nextBtn = document.getElementById("next-btn");
      const cards = Array.from(document.querySelectorAll(".polaroid-card"));

      // =========================
      // SCROLL REVEAL
      // =========================
      const revealEls = document.querySelectorAll(".reveal-up, .reveal-fade");
      const makeVisible = (el) => el.classList.add("is-visible");

      if ("IntersectionObserver" in window) {
        const io = new IntersectionObserver((entries, obs) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              makeVisible(entry.target);
              obs.unobserve(entry.target);
            }
          });
        });
        revealEls.forEach(el => io.observe(el));
      } else {
        revealEls.forEach(makeVisible);
      }

      // =========================
      // INTRO & SURAT
      // =========================
      sealed.classList.add("initial-blur");

      sealed.addEventListener("click", () => {
        sealed.classList.add("hidden");
        opened.classList.remove("hidden");
        opened.classList.add("initial-blur");

        letter.classList.remove("letter-fade-in");
        void letter.offsetWidth;
        letter.classList.add("letter-fade-in");

        setTimeout(() => {
          lagu?.play().catch(() => { });
        }, 100);
      });

      let letterStage = 0;
      let isAnimating = false;

      function goToPhotos() {
        if (letterStage === 2) return;

        hero.classList.add("fade-away");
        const onHeroFadeDone = (e) => {
          if (e.propertyName !== "opacity") return;
          hero.removeEventListener("transitionend", onHeroFadeDone);
          hero.classList.add("hidden");
        };
        hero.addEventListener("transitionend", onHeroFadeDone);

        // 1) tampilkan dulu (hapus display:none)
        photos.classList.remove("hidden");

        // 2) reset biar animasi bisa ke-trigger lagi
        photos.classList.remove("initial-blur");
        void photos.offsetWidth; // force reflow

        // 3) kasih 1 frame jeda baru pasang initial-blur
        requestAnimationFrame(() => {
          photos.classList.add("initial-blur-photos");
        });

        // (opsional) kalau kamu mau elemen reveal muncul belakangan, JANGAN langsung is-visible
        // kalau mau tetap langsung muncul seperti sebelumnya, boleh tetap pakai ini:
        document.querySelectorAll("#photos .reveal-up, #photos .reveal-fade").forEach(el => {
          el.classList.add("is-visible");
        });

        letterStage = 2;
      }


      letter.addEventListener("click", () => {
        if (isAnimating) return;

        if (letterStage === 0) {
          isAnimating = true;

          letter.classList.add("is-opening");
          letter.classList.add("letter-slide-up");
          opened.classList.add("env-drop");

          const onLetterDone = (e) => {
            if (e.propertyName !== "bottom") return;
            letter.removeEventListener("transitionend", onLetterDone);
            isAnimating = false;
            letterStage = 1;
            letter.classList.remove("is-opening");
          };
          letter.addEventListener("transitionend", onLetterDone);
          return;
        }

        if (letterStage === 1) {
          setTimeout(() => { goToPhotos(), 1000 });
        }
      });

      // =========================
      // PHOTOS -> VIDEO
      // =========================
      function transitionToVideo() {
        photos.classList.add("fade-away");

        setTimeout(() => {
          photos.classList.add("hidden");

          videoSection.classList.remove("hidden");
          videoSection.classList.add("initial-blur");

          videoSection.querySelectorAll(".reveal-up, .reveal-fade").forEach(el => {
            el.classList.add("is-visible");
          });

          setTimeout(() => {
            videoSection.classList.remove("initial-blur");
          }, 350);
        }, 600);
      }

      // klik kartu ended -> masuk video section
      cards.forEach(card => {
        card.addEventListener("click", () => {
          const currentCap = (card.querySelector(".caption")?.textContent || "");
          if (
            currentCap.includes("M. Khairul Ikhwan, S.E.") ||
            currentCap.includes("ð“¢Ö´à»‹ðŸŒ·Í™Ö’ á°”á©š") ||
            currentCap.includes("03/02/2026")
          ) {
            transitionToVideo();
          }
        });
      });

      // =========================
      // VIDEO -> CHOOSE
      // =========================
      function transitionToChoose() {
        videoSection.classList.add("fade-away");

        setTimeout(() => {
          videoSection.classList.add("hidden");

          chooseSection.classList.remove("hidden");
          chooseSection.classList.add("initial-blur");

          chooseSection.querySelectorAll(".reveal-up, .reveal-fade").forEach(el => {
            el.classList.add("is-visible");
          });

          setTimeout(() => {
            chooseSection.classList.remove("initial-blur");
          }, 350);
        }, 600);
      }

      // klik thumbnail: buka youtube TAB BARU + tab ini lanjut ke choose
      const preview = document.getElementById("ytPreview");
      if (preview) {
        const activate = () => {
          const url = `https://www.youtube.com/watch?v=${VIDEO_ID}&t=${START_TIME}s`;

          // 1) buka youtube tab baru
          // (kalau in-app browser ngeblock, tetap akan jalan bagian (2))
          window.open(url, "_blank", "noopener,noreferrer");

          // 2) tab ini pindah ke choose
          transitionToChoose();
        };

        preview.addEventListener("click", activate);
        preview.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            activate();
          }
        });
      }

      // =========================
      // FLIP LOGIC
      // =========================
      const set1 = [
        { def: "1.jpg", hov: "5.png", cap: "You" },
        { def: "2.jpeg", hov: "ikhwan2.png", cap: "did" },
        { def: "3.jpeg", hov: "5.png", cap: "great!â‹†Ë™âŸ¡" }
      ];
      const set2 = [
        { def: "grad.jpeg", hov: "grad1.jpg", cap: "M. Khairul Ikhwan, S.E." },
        { def: "grad.jpeg", hov: "grad2.jpg", cap: "ð“¢Ö´à»‹ðŸŒ·Í™Ö’ á°”á©š" },
        { def: "grad.jpeg", hov: "grad3.jpg", cap: "03/02/2026" }
      ];

      let showingSet2 = false;
      let flipping = false;

      function animateTitleSwap(nextText) {
        photosTitle.classList.add("title-swap-out");
        photosTitle.classList.remove("title-swap-in");

        setTimeout(() => {
          photosTitle.textContent = nextText;
          photosTitle.classList.remove("title-swap-out");
          photosTitle.classList.add("title-swap-in");
        }, 240);
      }

      function animateCaptionsOut() {
        cards.forEach(card => {
          const cap = card.querySelector(".caption");
          if (!cap) return;
          cap.classList.add("cap-swap-out");
          cap.classList.remove("cap-swap-in");
        });
      }

      function animateCaptionsIn() {
        cards.forEach(card => {
          const cap = card.querySelector(".caption");
          if (!cap) return;
          cap.classList.remove("cap-swap-out");
          cap.classList.add("cap-swap-in");
        });
      }

      function swapTo(setData) {
        cards.forEach((card, i) => {
          const defImg = card.querySelector(".img-default");
          const hovImg = card.querySelector(".img-hover");
          const cap = card.querySelector(".caption");
          if (!defImg || !hovImg || !cap) return;

          defImg.src = setData[i].def;
          hovImg.src = setData[i].hov;
          cap.textContent = setData[i].cap;
        });
      }

      nextBtn?.addEventListener("click", () => {
        if (flipping) return;

        flipping = true;
        nextBtn.disabled = true;

        cards.forEach(card => {
          card.classList.add("is-swapping");
          card.classList.add("flipping");
        });

        animateCaptionsOut();
        animateTitleSwap(showingSet2 ? "How It Started" : "How It Ends");

        setTimeout(() => {
          swapTo(showingSet2 ? set1 : set2);
        }, 360);

        setTimeout(() => {
          animateCaptionsIn();
        }, 520);

        setTimeout(() => {
          cards.forEach(card => {
            card.classList.remove("flipping");
            card.classList.remove("is-swapping");
          });

          showingSet2 = !showingSet2;

          // ended-mode aktif hanya saat set2 tampil
          photos.classList.toggle("ended-mode", showingSet2);

          flipping = false;
          nextBtn.disabled = false;
        }, 600);
      });
    });
    document.querySelectorAll(".choose-sealed").forEach(btn => {
      btn.addEventListener("click", () => {
        const to = btn.dataset.go;
        if (!to) return;
        window.open(to, "_blank", "noopener,noreferrer");
      });
    })
  </script>


</body>

</html>